<!DOCTYPE html>
<html lang="EN">
  <head>
    <meta charset="UTF-8" />
    <title>LKL Edu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.materialdesignicons.com/5.4.55/css/materialdesignicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../../images/favicon.png"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
  </head>

  <body>
    <!-- loading -->
    <div id="loading" class="loading">
      <div class="loading-overlay"></div>
      <div class="spinner"></div>
    </div>

    <!--Header-->
    <nav class="navbar navbar-expand-md bg-white navbar-white">
      <img id="logo" src="../../images/LKLlogo.png" />
    </nav>

    <!--DataView-->
    <div class="fit-content-w">
      <div class="row">
        <!--Menu-->
        <div class="col-sm-2 col-md-2 col-lg-2 col-xl-2">
          <nav class="navbar navbar-light" style="padding-top: 0px">
            <ul class="navbar-nav nav nav-pills">
              <div style="border-style: ridge; border-radius: 10px">
                <br />
                <img
                  src="../../images/ava2.png"
                  style="
                    border-radius: 50%;
                    height: 50%;
                    width: 50%;
                    display: block;
                    margin-left: auto;
                    margin-right: auto;
                  "
                />
                <li class="nav-item">
                  <p class="nav-link" style="text-align: center">
                    KentStaffAdmin
                  </p>
                </li>
              </div>
              <br />
              <li class="nav-item">
                <a class="nav-link" href="notificationListM.html">
                  Quản lý Thông báo
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li class="nav-item">
                <a class="nav-link" href="courseListM.html">
                  Quản lý Khóa học
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li class="nav-item active">
                <a class="nav-link" href="studyandexamScheduleM.html">
                  Quản lý Lịch học và thi
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li class="nav-item">
                <a class="nav-link" href="studentInfoM.html">
                  Quản lý TT Học viên
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li class="nav-item">
                <a class="nav-link" href="teacherInfoM.html">
                  Quản lý TT Giảng viên
                </a>
              </li>
              <div class="dropdown-divider"></div>
              <li class="nav-item">
                <a class="nav-link" href="../home.html"> Đăng xuất </a>
              </li>
              <div class="dropdown-divider"></div>
            </ul>
          </nav>
        </div>

        <!--DataGridView-->
        <div class="col-sm-5 col-md-5 col-lg-5 col-xl-10">
          <div>
            <h4 style="padding-left: 15px">
              <img
                src="../../images/studySchedule_icon.png"
                width="40"
                height="40"
                alt="folder icon"
              />
              Quản lý Lịch học
            </h4>

            <span onclick="openFormS()" class="l-btn noselect">
              Thêm Lịch học
            </span>

            <!--Study Schedule Info-->
            <table id="MyTable" class="table table-hover">
              <thead>
                <tr>
                  <th>Tên khóa học</th>
                  <th>Phòng</th>
                  <th>Thứ</th>
                  <th>Thời gian</th>
                  <th>Điều khiển</th>
                </tr>
              </thead>

              <tbody id="schedule-list"></tbody>
            </table>

            <!--Change Page-->
            <div style="box-shadow: 0px 0px 1px 1px gray"></div>
            <div
              class="d-flex"
              style="justify-content: space-between; align-items: center"
            >
              <span id="Previous" class="btn-x noselect">Tuần trước</span>
              <span id="show-date"></span>
              <span id="Next" class="btn-x noselect">Tuần sau</span>
            </div>
          </div>
          <br />
          <br />
          <br />

          <!--DataGridView-->
          <div>
            <h4 style="padding-left: 15px">
              <img
                src="../../images/examSchedule_icon.png"
                width="40"
                height="40"
                alt="folder icon"
              />
              Quản lý Lịch thi
            </h4>
            <!--Exam Schedule Info-->
            <span onclick="openFormE()" class="l-btn noselect">
              Thêm Lịch thi
            </span>
            <table id="MyTable" class="table table-hover">
              <thead>
                <tr>
                  <th>Tên khóa học</th>
                  <th>Phòng thi</th>
                  <th>Ngày thi</th>
                  <th>Thời gian</th>
                  <th>Điều khiển</th>
                </tr>
              </thead>

              <tbody id="examSchedule-list">
                <!--Subject 1-->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>


    <script type="text/javascript">
      function openFormS() {
        document.getElementById("popupFormS").style.display = "block";
      }
      function closeFormS() {
        document.getElementById("popupFormS").style.display = "none";
      }
      function openFormE() {
        document.getElementById("popupFormE").style.display = "block";
      }
      function closeFormE() {
        document.getElementById("popupFormE").style.display = "none";
      }

      function openFormSEdit() {
        document.getElementById("popupFormSEdit").style.display = "block";
      }
      function closeFormSEdit() {
        document.getElementById("popupFormSEdit").style.display = "none";
      }
      function openFormEEdit() {
        document.getElementById("popupFormEEdit").style.display = "block";
      }
      function closeFormEEdit() {
        document.getElementById("popupFormEEdit").style.display = "none";
      }
    </script>


    <!--PopupAdd-->
    <!--Popup Form StudySchedule-->
    <div
      class="form-popup"
      id="popupFormS"
      style="max-width: 500px; max-height: 550px; overflow: scroll"
    >
      <div class="form-container">
        <h1 style="text-align: center"><b>Thêm TT Lịch học</b></h1>
        <label for="nameCouseS"><b>Tên khóa học</b></label>
        <select
          id="schedule-course-name"
          name="nameCouseS"
          class="form-control course-selection"
          style="background-color: #f1f1f1; height: 50px"
        ></select>
        <br />

        <label for="roomCourseS"><b>Phòng</b></label>
        <input
          id="schedule-room"
          type="text"
          placeholder="Nhập phòng học"
          name="roomCourseS"
        />


        <label for="day"><b>Thứ</b></label>
        <div id="dayList" class="dayList" >
          <span class="anchor form-control" style="background-color: #f1f1f1;">Chọn Thứ</span>
          <ul class="items">
            <span class="noWrap"><label for="Monday">Thứ Hai:</label><input type="checkbox" id="Monday"/></span>
            <span class="noWrap"><label for="Tuesday">Thứ Ba :</label><input type="checkbox" id="Tuesday"/></span>
            <span class="noWrap"><label for="Wednesday">Thứ Tư :</label><input type="checkbox" id="Wednesday"/></span>
            <span class="noWrap"><label for="Thursday">Thứ Năm:</label><input type="checkbox" id="Thursday"/></span>
            <span class="noWrap"><label for="Friday">Thứ Sáu:</label><input type="checkbox" id="Friday"/></span>
            <span class="noWrap"><label for="Saturday">Thứ Bảy:</label><input type="checkbox" id="Saturday"/></span>
            <span class="noWrap"><label for="Sunday">Chủ Nhật:</label><input type="checkbox" id="Sunday"/></span>           
          </ul>
        </div>
        <br />

        <link rel="stylesheet" type="text/css" href="../../css/temp.css" />
        <script type="text/javascript">
          var checkboxList = document.getElementById('dayList');
          checkboxList.getElementsByClassName('anchor')[0].onclick = function(evt) {
            if(checkboxList.classList.contains('visible')){checkboxList.classList.remove('visible');}
            else{checkboxList.classList.add('visible');}
          }
        </script>


        <label for="timeCourseS"><b><p style="overflow: auto;" >Thời gian</p></b></label>
        <input
          id="schedule-duration"
          type="text"
          placeholder="Nhập thời gian học"
          name="timeCourseS"
        />

        <button onclick="handleAddSchedule()" type="submit" class="btn">
          Thêm
        </button>
        <button type="button" class="btn cancel" onclick="closeFormS()">
          Đóng
        </button>
      </div>
    </div>

    <!--Popup Form ExamSchedule-->
    <div
      class="form-popup"
      id="popupFormE"
      style="max-width: 500px; max-height: 550px; overflow: scroll"
    >
      <div class="form-container">
        <h1 style="text-align: center"><b>Thêm TT Lịch thi</b></h1>
        <label for="nameCouseE "><b>Tên khóa học</b></label>
        <select
          id="exam-schedule-course-name"
          name="nameCouseE"
          class="form-control course-selection"
          style="background-color: #f1f1f1; height: 50px"
        ></select>
        <br />
        <label for="roomCourseE"><b>Phòng thi</b></label>
        <input
          id="exam-schedule-room"
          type="text"
          placeholder="Nhập phòng thi"
          name="roomCourseE"
        />
        <label for="dateeCourseE"><b>Ngày thi</b></label>
        <input
          id="exam-schedule-exam_date"
          type="text"
          placeholder="Nhập ngày thi"
          name="dateeCourseE"
        />
        <label for="timeCourseE"><b>Thời gian</b></label>
        <input
          id="exam-schedule-duration"
          type="text"
          placeholder="Nhập thời gian thi"
          name="timeCourseE"
        />

        <button onclick="handleAddExamSchedule()" type="submit" class="btn">
          Thêm
        </button>
        <button type="button" class="btn cancel" onclick="closeFormE()">
          Đóng
        </button>
      </div>
    </div>

    <!--PopupEdit-->
    <!--Popup Form StudySchedule-->
    <div
      class="form-popup"
      id="popupFormSEdit"
      style="max-width: 500px; max-height: 550px; overflow: scroll"
    >
      <div class="form-container">
        <h1 style="text-align: center"><b>Sửa TT Lịch học</b></h1>
        <label for="nameCouseS"><b>Tên khóa học</b></label>
        <select
          id="edit-schedule-course-name"
          name="nameCouseS"
          class="form-control course-selection"
          style="background-color: #f1f1f1; height: 50px"
        ></select>
        <br />
        <label for="roomCourseS"><b>Phòng</b></label>
        <input
          id="edit-schedule-room"
          type="text"
          placeholder="Nhập phòng học"
          name="roomCourseS"
        />

        <label id="edit-schedule-week_date" for="day"><b>Thứ</b></label>
        <select
          id="edit-schedule-week_date"
          name="day"
          class="form-control"
          style="background-color: #f1f1f1; height: 50px"
        >
          <option disabled selected value>Chọn thứ</option>
          <option value="Monday">Thứ Hai</option>
          <option value="Tuesday">Thứ Ba</option>
          <option value="Wednesday">Thứ Tư</option>
          <option value="Thursday">Thứ Năm</option>
          <option value="Friday">Thứ Sáu</option>
          <option value="Saturday">Thứ Bảy</option>
          <option value="Sunday">Chủ Nhật</option>


        </select>
        <br />

        <label for="timeCourseS"><b>Thời gian</b></label>
        <input
          id="edit-schedule-duration"
          type="text"
          placeholder="Nhập thời gian học"
          name="timeCourseS"
        />

        <button onclick="handleEditScheduleById()" type="submit" class="btn">
          Xác nhận
        </button>
        <button type="button" class="btn cancel" onclick="closeFormSEdit()">
          Đóng
        </button>
      </div>
    </div>

    <!--Popup Form ExamSchedule-->
    <div
      class="form-popup"
      id="popupFormEEdit"
      style="max-width: 500px; max-height: 550px; overflow: scroll"
    >
      <div class="form-container">
        <h1 style="text-align: center"><b>Sửa TT Lịch thi</b></h1>
        <label for="nameCouseE"><b>Tên khóa học</b></label>
        <select
          id="edit-exam-schedule-course-name"
          name="nameCouseE"
          class="form-control course-selection"
          style="background-color: #f1f1f1; height: 50px"
        ></select>
        <br />
        <label for="roomCourseE"><b>Phòng thi</b></label>
        <input
          id="edit-exam-schedule-room"
          type="text"
          placeholder="Nhập phòng thi"
          name="roomCourseE"
          value="A705"
        />
        <label for="dateCourseE"><b>Ngày thi</b></label>
        <input
          id="edit-exam-schedule-exam_date"
          type="text"
          placeholder="Nhập ngày thi"
          name="dateeCourseE"
          value="01/12/2020"
        />
        <label for="timeCourseE"><b>Thời gian</b></label>
        <input
          id="edit-exam-schedule-duration"
          type="text"
          placeholder="Nhập thời gian thi"
          name="timeCourseE"
          value="90 phút"
        />

        <button
          type="submit"
          class="btn"
          onclick="handleUpdateExamScheduleById()"
        >
          Xác nhận
        </button>
        <button type="button" class="btn cancel" onclick="closeFormEEdit()">
          Đóng
        </button>
      </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Xóa</h5>
            <button type="button" class="close" data-dismiss="modal">
              &times;
            </button>
          </div>
          <div class="modal-body">
            <p>Bạn có chắc chắn muốn xóa?</p>
          </div>
          <div class="modal-footer">
            <button
              id="confirm-popup"
              type="button"
              class="btn btn-default"
              onclick="confirmFalse()"
              data-dismiss="modal"
            >
              Đóng
            </button>

            <div style="display: inline">
              <input id="deleteitem" type="hidden" name="confirm" />
              <button
                type="submit"
                class="btn btn-danger"
                onclick="confirmTrue()"
              >
                Xác nhận
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--Footer-->
    <div id="footer">
      <div class="row">
        <!--Map Picture-->
        <img
          src="../../images/map.png"
          width="400"
          heigh="400"
          class="flex map"
        />
        <!--Info Footer-->
        <div class="infoFooter">
          <h>Nhóm phát triển phần mềm LKL Edu</h><br />
          <h>19 Nguyễn Hữu Thọ,Tân Phong,Q7,TPHCM</h><br />
          <h>Hotline: (+84) 0987654321</h><br />
          <h>Email: lklsupport@gmail.com</h><br />
          <h>Copyright © 2020 by lkledu.vn</h><br />
          <!--Some Other Media-->
          <img
            src="../../images/twitterLogo.png"
            width="100"
            class="twitterLogo"
          />
          <img src="../../images/facebookLogo.png" width="60" />
          <img src="../../images/instagramLogo.png" width="55" />
        </div>
      </div>
      <!--Product Footer-->
      <div class="productFooter">
        <p>
          <img
            src="https://kichi.ggg.com.vn/wp-content/uploads/2018/10/bct.png"
          />
        </p>
        <p>Producted by LKL Software Team.</p>
      </div>
    </div>

    <script src="../../js/index.js"></script>
    <script src="../../js/buildCourseSelection.js"></script>
    <script src="../../js/addSchedule.js"></script>
    <script src="../../js/getScheduleForModerator.js"></script>
    <script src="../../js/deleteScheduleById.js"></script>
    <script src="../../js/updateScheduleById.js"></script>
    <script src="../../js/getExamScheduleForModerator.js"></script>
    <script src="../../js/addExamSchedule.js"></script>
    <script src="../../js/deleteExamScheduleById.js"></script>
    <script src="../../js/updateExamSchedule.js"></script>
    <script>
      getWeekDate();
      getScheduleForModerator(week);
      getExamScheduleForModerator();
      buildCourseSelection();

      Previous.onclick = () => {
        preWeek();
        getScheduleForModerator(week);
      };

      Next.onclick = () => {
        nextWeek();
        getScheduleForModerator(week);
      };

      function handleAddSchedule() {
        activeElement("loading");
        const name =
          document.querySelector("#schedule-course-name").value || "chưa có";
        const courseId = document
          .getElementById("schedule-course-name")
          .selectedOptions[0].getAttribute("data-course-id");
        const room =
          document.querySelector("#schedule-room").value || "chưa có";
        const week_date =
          document.querySelector("#schedule-week_date").value || "chưa có";
        const duration =
          document.querySelector("#schedule-duration").value || "chưa có";

        addSchedule(courseId, name, room, week_date, duration, week);
      }

      function handleDeleteScheduleById(scheduleId) {
        activeElement("loading");
        deleteScheduleById(scheduleId);
      }

      let selectedScheduleId;

      function handleOpenFormEditScheduleById(idx) {
        const schedule = scheduleList[idx];
        selectedScheduleId = schedule.id;
        document.querySelector("#edit-schedule-course-name").value =
          schedule.name;
        document.querySelector("#edit-schedule-room").value = schedule.room;
        document.querySelector("#edit-schedule-week_date").value =
          schedule.week_date;
        document.querySelector("#edit-schedule-duration").value =
          schedule.duration;

        openFormSEdit();
      }

      function handleEditScheduleById() {
        activeElement("loading");
        closeFormSEdit();
        const name = document.querySelector("#edit-schedule-course-name").value;
        const courseId = document
          .getElementById("edit-schedule-course-name")
          .selectedOptions[0].getAttribute("data-course-id");
        const room = document.querySelector("#edit-schedule-room").value;
        const week_date = document.querySelector("#edit-schedule-week_date")
          .value;
        const duration = document.querySelector("#edit-schedule-duration")
          .value;

        updateScheduleById(
          selectedScheduleId,
          courseId,
          name,
          room,
          week_date,
          duration
        );
      }

      // Exam
      function openPopupConfirmDeleteExamSchedule(examScheduleId) {
        examScheduleIdSelected = examScheduleId;
        isDeleteExamSchedule = false;
        $("#myModal").modal({
          backdrop: "static",
          keyboard: false,
        });
      }

      let isDeleteExamSchedule = undefined;
      let examScheduleIdSelected;

      function confirmFalse() {
        isDeleteExamSchedule = undefined;
      }

      function confirmTrue() {
        if (isDeleteExamSchedule != undefined) {
          isDeleteExamSchedule = true;
          handleDeleteExamScheduleById();
          // close confirm
          document.getElementById("confirm-popup").click();
        }
      }

      function handleAddExamSchedule() {
        activeElement("loading");
        const name =
          document.querySelector("#exam-schedule-course-name").value ||
          "chưa có";
        const course_id = document
          .getElementById("exam-schedule-course-name")
          .selectedOptions[0].getAttribute("data-course-id");
        const room =
          document.querySelector("#exam-schedule-room").value || "chưa có";
        const exam_date =
          document.querySelector("#exam-schedule-exam_date").value || "chưa có";
        const exam_duration =
          document.querySelector("#exam-schedule-duration").value || "chưa có";

        addExamSchedule(name, course_id, room, exam_date, exam_duration);
      }

      function handleDeleteExamScheduleById() {
        if (isDeleteExamSchedule) {
          activeElement("loading");
          deleteExamScheduleById(examScheduleIdSelected);
        }
      }

      function handleOpenFormEditExamScheduleById(idx) {
        openFormEEdit();
        const examSchedule = examScheduleList[idx];
        examScheduleIdSelected = examSchedule.id;
        document.querySelector("#edit-exam-schedule-course-name").value =
          examSchedule.name;
        document.querySelector("#edit-exam-schedule-room").value =
          examSchedule.room;
        document.querySelector("#edit-exam-schedule-exam_date").value =
          examSchedule.exam_date;
        document.querySelector("#edit-exam-schedule-duration").value =
          examSchedule.exam_duration;
      }

      function handleUpdateExamScheduleById() {
        activeElement("loading");
        closeFormEEdit();
        const id = examScheduleIdSelected;
        const course_id = document
          .getElementById("edit-exam-schedule-course-name")
          .selectedOptions[0].getAttribute("data-course-id");
        const name = document.querySelector("#edit-exam-schedule-course-name")
          .value;
        const room = document.querySelector("#edit-exam-schedule-room").value;
        const exam_date = document.querySelector(
          "#edit-exam-schedule-exam_date"
        ).value;
        const exam_duration = document.querySelector(
          "#edit-exam-schedule-duration"
        ).value;
        updateExamSchedule(id, course_id, name, room, exam_date, exam_duration);
      }
    </script>
  </body>
</html>
